<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="transport layer messages are divided into segments passed to network layer  sender: encapsulates segments into IP packets, passes to link layer reciever: deliver segments to tranport layer protocol sender and reciever are connected by multple routers   routers  examine header fields in all IP packets passing through it moves IP packers from input ports to output ports to transfer packets along end-end path   network layer protocols  IP internet control message protocol (ICMP)  use for troubleshooting type things       Forwarding forwarding"><title>19-network-layer-data-plane</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://jethughes.github.io/notes//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://jethughes.github.io/notes/styles.1a1ffb6f8cc2d9990f06b61d70c9b09b.min.css rel=stylesheet><script src=https://jethughes.github.io/notes/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://jethughes.github.io/notes/js/popover.688c5dcb89a57776d7f1cbeaf6f7c44b.min.js></script>
<script>const BASE_URL="https://jethughes.github.io/notes/",fetchData=Promise.all([fetch("https://jethughes.github.io/notes/indices/linkIndex.ae4dec3efb1a98adbe237006247a15a7.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://jethughes.github.io/notes/indices/contentIndex.e027e2a7e741b55f5820f0abf2c1d297.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL("https://jethughes.github.io/notes/"),s=n.pathname,o=window.location.pathname,i=s==o,e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!1;drawGraph("https://jethughes.github.io/notes",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://jethughes.github.io/notes",!0,!0)},init=(e=document)=>{renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/jethughes.github.io\/notes\/js\/router.557a499829be51f9008c6efa5b73602a.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://jethughes.github.io/notes/js/search.cf33b507388f3dfd5513a2afcda7af41.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://jethughes.github.io/notes/>Jet's Notes</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>19-network-layer-data-plane</h1><p class=meta>Last updated November 21, 2022</p><ul class=tags><li><a href=https://jethughes.github.io/notes/tags/cosc203/>Cosc203</a></li><li><a href=https://jethughes.github.io/notes/tags/lecture/>Lecture</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#subnetting>subnetting</a></li><li><a href=#fragmentation>fragmentation</a></li><li><a href=#special-ipv4-adresses-and-nat>special IPv4 Adresses and NAT</a></li></ol></nav></details></aside><ul><li>transport layer messages are divided into segments</li><li>passed to network layer<ul><li>sender: encapsulates segments into IP packets, passes to link layer</li><li>reciever: deliver segments to tranport layer protocol</li><li>sender and reciever are connected by multple routers</li></ul></li><li>routers<ul><li>examine header fields in all IP packets passing through it</li><li>moves IP packers from input ports to output ports to transfer packets along end-end path</li></ul></li><li>network layer protocols<ul><li>IP</li><li>internet control message protocol (ICMP)<ul><li>use for troubleshooting type things</li></ul></li></ul></li></ul><p><img src=https://i.imgur.com/Y9ue6gE.png alt="packet diagram"></p><a href=#forwarding><h1 id=forwarding><span class=hanchor arialabel=Anchor># </span>Forwarding</h1></a><p>forwarding</p><ul><li>move packets from a routers input link to appropriate output link</li><li>local, per-router function</li><li>function in data plane</li></ul><p>routing</p><ul><li>determine route taken by packets from source to destination<ul><li>network-wide logic</li><li>function in control plane</li><li>chooses shortest path through routers</li></ul></li></ul><a href=#network-layer-service-model><h1 id=network-layer-service-model><span class=hanchor arialabel=Anchor># </span>network layer service model</h1></a><p>best effort</p><ul><li>try its best to deliver packet</li><li>does not guarantee successful delivery</li><li>transport layer provides reliability</li><li>no big deal if packet is lost</li><li>does not guarantee timing or order of delivery<ul><li>each packet sent individually, possibly through different paths</li></ul></li><li>does not guarantee bandwidth available<ul><li>network layer uses packet switching which unlike socket switching does not reserve resources</li></ul></li></ul><a href=#routers><h1 id=routers><span class=hanchor arialabel=Anchor># </span>Routers</h1></a><p><img src=https://i.imgur.com/fNTeZnZ.png alt="architecture overview"></p><p>destination-based forwarding: foward based only on destination IP address</p><p>input port queueing: if datagrams arrive faster than fowarding rate into switch fabric</p><a href=#ip-addressing><h1 id=ip-addressing><span class=hanchor arialabel=Anchor># </span>IP addressing</h1></a><ul><li>unreliable host-to-host communication protocol<ul><li>datagram formatting, IP addressing, packet switching</li></ul></li></ul><p><img src=https://i.imgur.com/2ehI0Kq.png alt="IP packet headers"></p><ul><li>ver: IP protocol versin number</li><li>head len: header length in bytes</li><li>type of service: diffserv(0:5) or ECN (6:7)</li><li>length: total datagram length (bytes)</li><li>time to live: remaining max hops (decremented at each router)</li><li>upper layer: which protocol use at transport layer</li><li>16-bit id, flgs, fragment offset: fragmentation/reassembly</li><li>header checksum</li><li>source IP</li><li>destination IP</li><li>options: e.g., timestamp, record route taken</li></ul><p>overhead:</p><ul><li>20 bytes TCP</li><li>20 bytes IP</li><li>= 40 bytes + app layer overhead for TCP+IP</li></ul><p>interface: connection between host/router and physical link</p><ul><li>router have multiple interfaces</li><li>host has one or two interfaces :e.g., ethernet and wireless</li></ul><p>IPv4 address: 32-bit id associated with each host or router interface
<img src=https://i.imgur.com/N0hB8u8.png alt="dotted decimal IP address notation"></p><ul><li>two main components<ul><li>network ID<ul><li>addresses in the same network have the same network ID</li></ul></li><li>host ID</li></ul></li><li>5 classes<ul><li><img src=https://i.imgur.com/9dOLoyr.png alt></li></ul></li></ul><a href=#subnetting><h2 id=subnetting><span class=hanchor arialabel=Anchor># </span>subnetting</h2></a><ul><li>partitioning an IP network into multiple smaller network segments<ul><li>designate some high-order bits from host part as subnet ID</li><li><img src=https://i.imgur.com/wGjPOJb.png alt></li></ul></li><li>netmask<ul><li>a 32-bit number with all 1s for network part and all 0s for host part</li></ul></li></ul><p><img src=https://i.imgur.com/7COPiAh.png alt=example></p><ul><li>use bitwise and to find network part from address and mask</li></ul><a href=#fragmentation><h2 id=fragmentation><span class=hanchor arialabel=Anchor># </span>fragmentation</h2></a><ul><li>network links have an MTU (maximum transmission unit)<ul><li>different linktypes have different MTUs</li></ul></li><li>large UP datagrams are fragmented at routers<ul><li>one datagram become several</li><li>reassemble only at destination</li><li>IP header bits are used to identify fragments</li></ul></li></ul><p>header</p><ul><li>identifier<ul><li>same for all fragments</li></ul></li><li>flag: 3 bits<ul><li>1st not used</li><li>2nd - do fragment</li><li>3rd - more fragment (0 for the last fragment)</li></ul></li><li>offset<ul><li>offset of the fragment in the packets data field (units of 8 bytes)</li></ul></li></ul><p><img src=https://i.imgur.com/eENmMTd.png alt="frag example"></p><p>what needs to change in the header of fragment</p><ul><li>flag</li><li>offset</li><li>length</li><li>ttl</li><li>checksum</li></ul><a href=#special-ipv4-adresses-and-nat><h2 id=special-ipv4-adresses-and-nat><span class=hanchor arialabel=Anchor># </span>special IPv4 Adresses and NAT</h2></a><p>special addresses</p><ul><li>127.0.0.1 localhost/loopback</li><li>10.0.0.0/8 private use</li><li>192.168.0.0/16 private use</li></ul><p>NAT (network address translation): all devices in local network share just one IPv4 address</p><ul><li>allow multiple devices to share the same adresses</li><li>help preserve the limited amount of IP address</li><li>translate from private IP to public IP</li><li><img src=https://i.imgur.com/fU7hTbO.png alt="NAT diagram"></li></ul><a href=#ipv6><h1 id=ipv6><span class=hanchor arialabel=Anchor># </span>IPv6</h1></a><ul><li>inital motivation: IPv4 mostly used up</li><li>additional motivation<ul><li>speed prcessing/forwarding: 40 byte fixed length header</li><li>enable different network-layer treatment of &ldquo;flows&rdquo;</li><li>better support for host mobility</li><li>better support for security</li></ul></li></ul><p>datagram format
<img src=https://i.imgur.com/6O7jPQg.png alt></p><p>adressses</p><ul><li>128 bits</li><li>hexadecimal colon notation<ul><li>12AB:0000:0000:CD30:0000:0000:0000:0000</li></ul></li><li>adress compression<ul><li>consecutive sections of seros are replaced with ::</li><li>can be used only once per address</li><li>e.g., 12AB:0000:0000:CD30::</li></ul></li></ul><p>CIDR</p><ul><li>classless interdomain routing</li><li>method for allocating IP addresses and IP routing</li><li>notation<ul><li>based of variable length subnet mask (VLSM)</li><li>address format: IP address/x, where x is number of bits from left to right as network part</li><li><img src=https://i.imgur.com/n681AV1.png alt></li></ul></li></ul><p>extension headers:
<img src=https://i.imgur.com/8rM3clb.png alt>
differencees:
<img src=https://i.imgur.com/cWKDpEY.png alt></p><a href=#transition-from-v4-to-v6><h1 id=transition-from-v4-to-v6><span class=hanchor arialabel=Anchor># </span>transition from v4 to v6</h1></a><ul><li>cant change all router at once</li><li>will need mixed v4 and v6 routers</li></ul><p>tunneling</p><ul><li>v6 datagram is carried as the payload in v4 datagram among v4 routers (&ldquo;packet with a packet&rdquo;)</li><li>used alot with 4G/5G</li><li><img src=https://i.imgur.com/h4awnaL.png alt=example></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://jethughes.github.io/notes/js/graph.afdb02e537635f9a611b53a988e5645b.js></script></div></div><div id=contact_buttons><footer><p>Made with <a href=https://obsidian.md>Obsidian</a> using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, 2022</p><ul><li><a href=/notes/>Home</a></li><li><a href=https://github.com/jethughes>Github</a></li><li><a href=https://www.linkedin.com/in/jet-hughes-b3b688237>LinkedIn</a></li></ul></footer></div></div></body></html>