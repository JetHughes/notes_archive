<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="DAEMON
 A process that runs in the background and is independent of control from all terminals Reasons for daemons’ independence of terminals  Prevent daemons’ error message from appearing on a user’s terminal Signals generated from terminal keys must not affect any daemons that were started from that terminal earlier   Typical daemons  crond, syslogd    DAEMONIZATION"><title>10-scheduled-tasks-and-logs</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://jethughes.github.io/notes//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://jethughes.github.io/notes/styles.1a1ffb6f8cc2d9990f06b61d70c9b09b.min.css rel=stylesheet><script src=https://jethughes.github.io/notes/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://jethughes.github.io/notes/js/popover.688c5dcb89a57776d7f1cbeaf6f7c44b.min.js></script>
<script>const BASE_URL="https://jethughes.github.io/notes/",fetchData=Promise.all([fetch("https://jethughes.github.io/notes/indices/linkIndex.dd7a0bcd0bf1e3b79542f962c24d0858.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://jethughes.github.io/notes/indices/contentIndex.58bc9f9efda1a2b22e741082ccc5267b.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL("https://jethughes.github.io/notes/"),s=n.pathname,o=window.location.pathname,i=s==o,e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!1;drawGraph("https://jethughes.github.io/notes",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://jethughes.github.io/notes",!0,!0)},init=(e=document)=>{renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/jethughes.github.io\/notes\/js\/router.557a499829be51f9008c6efa5b73602a.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://jethughes.github.io/notes/js/search.cf33b507388f3dfd5513a2afcda7af41.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://jethughes.github.io/notes/>Jet's Notes</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>10-scheduled-tasks-and-logs</h1><p class=meta>Last updated March 29, 2023</p><ul class=tags><li><a href=https://jethughes.github.io/notes/tags/lecture/>Lecture</a></li><li><a href=https://jethughes.github.io/notes/tags/cosc301/>Cosc301</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents></nav></details></aside><p>DAEMON</p><ul><li>A process that runs in the background and is independent of control from all terminals</li><li>Reasons for daemons’ independence of terminals<ul><li>Prevent daemons’ error message from appearing on a user’s terminal</li><li>Signals generated from terminal keys must not affect any daemons that were started from that terminal earlier</li></ul></li><li>Typical daemons<ul><li>crond, syslogd</li></ul></li></ul><p>DAEMONIZATION</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>if( (pid = fork()) != 0) exit(0); //parent terminates 
</span></span><span class=line><span class=cl>setsid(); // become session leader 
</span></span><span class=line><span class=cl>signal(SIGHUP, SIG_IGN); if( (pid = fork()) != 0) exit(0); //new child continues 
</span></span><span class=line><span class=cl>//now it becomes daemon
</span></span></code></pre></td></tr></table></div></div><p>The purpose is to make the process independent of the control from any terminals.</p><blockquote><p>[!INFO] when you are independent from parent you are a leader.
need to ignore sighup signal otherwise child would be automatically terminated when the parent is killed.</p></blockquote><p>SCHEDULED TASKS</p><ul><li>Automating tasks<ul><li>crond and crontab</li><li>crond is a very important daemon for automatically executing tasks</li><li>Tasks can be configured to repeat hourly, daily, weekly,…, or even per minute.</li></ul></li><li>Possible uses<ul><li>Clean file systems</li><li>Log rotate</li><li>Check log files</li><li>Monitor system status and resources</li></ul></li></ul><blockquote><p>[!INFO] can run any command/script on a schedule
for security you should scan logs everyday to check for keywords
useing grep, sed, awk</p></blockquote><p>SYSLOGD</p><ul><li>How it works?<ul><li>Read the configuration file /etc/syslog.conf</li><li>A Unix domain socket is created and bound to the pathname /var/run/log</li><li>A UDP socket is created and bound to port 514</li><li>Runs in an infinite loop that calls select, waiting for any one of the above descriptors to be readable, reads the log message, and does what the configuration file says to do with that message.</li><li>If the daemon receives the SIGHUP signal, it rereads the configuration file</li></ul></li></ul><blockquote><p>[!INFO] syslogd is a daemon.</p></blockquote><p>LOGGING FUNCTIONS</p><ul><li>How start and close logging?<ul><li>Create a Unix domain datagram socket and send out messages to the pathname the daemon has bound, or send them to port 514 by a UDP socket</li><li>openlog() and closelog()</li></ul></li><li>How to send log messages<ul><li>void syslog(int priority, const char *message, …);</li><li>priority is a combination of a level and a facility shown later</li><li>message is like a format string to printf, with the addition of a %m specification, which is replaced with the error message corresponding to the current value of errno.</li></ul></li></ul><blockquote><p>[!INFO] some log messages go to other locations</p></blockquote><p>Example code</p><ul><li>openlog (&ldquo;mylibrary&rdquo;, option, priority);</li><li>syslog (LOG_INFO, “My library has been invoked”);</li><li>closelog ();</li></ul><p>Level</p><ul><li>LOG_EMERG (0): system is unusable</li><li>LOG_ALERT (1): action must be taken immediately</li><li>LOG_CRIT (2): critical conditions</li><li>LOG_ERR (3): error conditions</li><li>LOG_WARNING (4): warning conditions</li><li>LOG_NOTICE (5): normal but significant conditions</li><li>LOG_INFO (6): informational</li><li>LOG_DEBUG (7): debug-level messages, has lowest priority</li></ul><blockquote><p>[!INFO] applies to individual applications as well as the kernel. e.g., LOG_EMERG in a application will exit straight after
ERR most relevant to us
need to set this level in syslogd.conf</p></blockquote><p>Facility</p><ul><li>Identify the type of process sending the message</li><li>Facilities<ul><li>LOG_AUTH: security/authorization messages</li><li>LOG_AUTHPRIV: security/authorization messages (private)</li><li>LOG_CRON: from crond</li><li>LOG_KERN: kernel messages</li><li>LOG_MAIL: mail system</li><li>LOG_USER: random user-level messages (default)</li><li>LOG_FTP: from ftpd</li><li>LOG_LPR: line printer system</li><li>LOG_SYSLOG: internal messages from syslogd</li><li>LOG_LOCAL0</li><li>LOG_LOCAL7: local, discretional use by programmers.</li></ul></li></ul><p>klogd</p><ul><li>klogd provides a facility for system admin to check only kernel messages (which can also be checked through syslogd)</li><li>Kernel messages can be read from /proc/kmsg</li><li>Use /proc/sys/kernel/printk to control the level of log messages.<ul><li>cat /proc/sys/kernel/printk</li></ul></li></ul><blockquote><p>[!INFO] /proc has kernel information about system
klogd is an application level deamon that cleans up logs</p></blockquote><p>syslog.conf</p><ul><li>Syslogd configuration file<ul><li>/etc/syslog.conf</li><li>Consists of . entries</li></ul></li><li>mail.* /var/log/maillog</li><li>authpriv.* /var/log/secure</li><li>*.alert root, mal<ul><li>Use “man 5 syslog.conf” to find more information about the format of the file</li></ul></li></ul><p>Log processing</p><ul><li>Log scanning and filtering<ul><li>Scanning: use scripts (put as a cron job) to scan key words in log files</li><li>Filtering: use scripts to remove useless messages from the log files</li></ul></li><li>Pros and cons of scanning and filtering<ul><li>Scanning: can find useful information, but may have to process a large amount of log files</li><li>Filtering: can reduce the amount of log files but may miss some useful information</li></ul></li></ul><blockquote><p>[!INFO] remove uncessesary logs
grep is scanning
can be filtering with the -v flag</p></blockquote><p>Log processing (cont.)</p><ul><li>Log rotation<ul><li>Use logrotate command<ul><li>logrotate is designed to ease administration of systems that generate large number of log files. It allows automatic rotation, compression, removal, and mailing of log files. Each log file may be handled daily, weekly, monthly, or when it grows too large</li></ul></li><li>Configuration file:/etc/logrotate.conf (see the manual page for logrotate)</li><li>Run logrotate as a cron jo</li></ul></li></ul><p>Log processing (cont.)</p><ul><li>Store log files in computer archive<ul><li>Legal issues regarding how long log files should be stored.</li><li>How to process a huge amount of log files efficiently?</li></ul></li><li>Risks of log management<ul><li>Log files can be changed (MD5?)</li><li>Log files can be exposed while being transmitted (encryption?)</li></ul></li></ul><blockquote><p>[!INFO] checksum for knowing if someone changed logs
encryption
legal issues (how long to store)</p></blockquote><p>Cloud services for sharing?</p><ul><li>Privacy issue</li><li>Issue on confidential information</li><li>Who owns the data?</li><li>Enterprise cloud is recommended for sharing confidential documents inside an organization.</li><li>git and svn are good tools for sharing.</li></ul><p>Set up cloud services</p><ul><li>It is possible to set up cloud services in Ubuntu using cloud-init with a simple recipe.</li><li>Video of using cloud-init<ul><li><a href=https://cloud-init.io/ rel=noopener>https://cloud-init.io/</a></li></ul></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://jethughes.github.io/notes/js/graph.afdb02e537635f9a611b53a988e5645b.js></script></div></div><div id=contact_buttons><footer><p>Made with <a href=https://obsidian.md>Obsidian</a> using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, 2023</p><ul><li><a href=/notes/>Home</a></li><li><a href=https://github.com/jethughes>Github</a></li><li><a href=https://www.linkedin.com/in/jet-hughes-b3b688237>LinkedIn</a></li></ul></footer></div></div></body></html>