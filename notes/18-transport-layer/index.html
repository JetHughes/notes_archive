<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="chapter 3
service provided by transport layer services
 process to process communication  logical communication between application processes   multi and demulti plexing  communication for multiple applications of the same host   flow control  ensure production reate <= consuption rate   congestion control  too many sender, sending too fast    protocols"><title>18-transport-layer</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://jethughes.github.io/notes//icon.png><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:wght@400;600;700&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><link href=https://jethughes.github.io/notes/styles.1a1ffb6f8cc2d9990f06b61d70c9b09b.min.css rel=stylesheet><script src=https://jethughes.github.io/notes/js/darkmode.46b07878b7f5d9e26ad7a3c40f8a0605.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://jethughes.github.io/notes/js/popover.688c5dcb89a57776d7f1cbeaf6f7c44b.min.js></script>
<script>const BASE_URL="https://jethughes.github.io/notes/",fetchData=Promise.all([fetch("https://jethughes.github.io/notes/indices/linkIndex.432b3bcdf29bcac58e402ae080b9c22b.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://jethughes.github.io/notes/indices/contentIndex.699cdb5a43ce9eda1b13cde6f57a25fa.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL("https://jethughes.github.io/notes/"),s=n.pathname,o=window.location.pathname,i=s==o,e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!1;drawGraph("https://jethughes.github.io/notes",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://jethughes.github.io/notes",!0,!0)},init=(e=document)=>{renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/jethughes.github.io\/notes\/js\/router.557a499829be51f9008c6efa5b73602a.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://jethughes.github.io/notes/js/search.cf33b507388f3dfd5513a2afcda7af41.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://jethughes.github.io/notes/>Jet's Notes</a></h1><svg tabindex="0" id="search-icon" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg><div class=spacer></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>18-transport-layer</h1><p class=meta>Last updated October 22, 2022</p><ul class=tags><li><a href=https://jethughes.github.io/notes/tags/cosc203/>Cosc203</a></li><li><a href=https://jethughes.github.io/notes/tags/lecture/>Lecture</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#actions-and-sender>actions and sender</a></li><li><a href=#actions-at-reciever>actions at reciever</a></li></ol><ol><li><a href=#how-it-works>how it works</a></li><li><a href=#principle-of-reliable-data-transfer>principle of reliable data transfer</a></li></ol><ol><li><a href=#connections-setup>connections setup</a></li><li><a href=#connection-termination>connection termination</a></li><li><a href=#tcp-flow-control>TCP flow control</a><ol><li><a href=#congestion-control>congestion control</a></li></ol></li></ol></nav></details></aside><p>chapter 3</p><a href=#service-provided-by-transport-layer><h1 id=service-provided-by-transport-layer><span class=hanchor arialabel=Anchor># </span>service provided by transport layer</h1></a><p>services</p><ul><li>process to process communication<ul><li>logical communication between application processes</li></ul></li><li>multi and demulti plexing<ul><li>communication for multiple applications of the same host</li></ul></li><li>flow control<ul><li>ensure production reate &lt;= consuption rate</li></ul></li><li>congestion control<ul><li>too many sender, sending too fast</li></ul></li></ul><p>protocols</p><ul><li>TCP transmission control protocol</li><li>UDP user datagram protocol</li></ul><a href=#actions-and-sender><h2 id=actions-and-sender><span class=hanchor arialabel=Anchor># </span>actions and sender</h2></a><ul><li>is passed an app layer message</li><li>determines segment header fields values</li><li>creates segment</li><li>passes segement to IP layer</li></ul><a href=#actions-at-reciever><h2 id=actions-at-reciever><span class=hanchor arialabel=Anchor># </span>actions at reciever</h2></a><ul><li>recieves segment from IP layer</li><li>checks header values</li><li>extract app layer message</li><li>de multiplexes message up to application via socket</li></ul><a href=#multiplexing-and-demultiplexing><h1 id=multiplexing-and-demultiplexing><span class=hanchor arialabel=Anchor># </span>multiplexing and demultiplexing</h1></a><p>sender: handle data from multiple sockets, add transport header
reciever: user header info to deliver segments to correct socket</p><p><img src=https://i.imgur.com/f2NqsKE.png alt></p><a href=#how-it-works><h2 id=how-it-works><span class=hanchor arialabel=Anchor># </span>how it works</h2></a><p>port number</p><ul><li>16 bit integer (0, 66635)</li><li>segment has a source and a port number</li><li>host uses IP and port to direct segment to appropriate socket</li></ul><p>IANA (internet assign number authority) has divded port number into three ranges</p><ul><li>0-1023 well known</li><li>1024-49151 registered</li><li>49152-65535 dynamic</li></ul><a href=#principle-of-reliable-data-transfer><h2 id=principle-of-reliable-data-transfer><span class=hanchor arialabel=Anchor># </span>principle of reliable data transfer</h2></a><p><img src=https://i.imgur.com/ORzC8jm.png alt></p><ul><li>compexity of reliable data transfer protocol depends on character istics of unreliable channel</li><li>sender and reciever do not know the &lsquo;state&rsquo; of each other. they need to communicate via a message - ACKknowledgement</li></ul><a href=#tcp><h1 id=tcp><span class=hanchor arialabel=Anchor># </span>TCP</h1></a><ul><li>point to point communicate<ul><li>one sender, one reciever</li></ul></li><li>reliable, in-order byte stream<ul><li>no message boundaries</li><li>each byte has a position in the stream</li></ul></li><li>full duplex data<ul><li>bi directional data flow in the same connection</li><li>MSS: maximum segment size</li></ul></li><li>cumulative ACKs<ul><li>one ack message confirms multiple segments</li></ul></li><li>connection-oriented<ul><li>handshaking (exchange of control messages) initializes sender, reciever state before data exchange</li></ul></li><li>flow controlled<ul><li>sender will not overwhelm reciever</li></ul></li><li>congestion controlled<ul><li>dynamically adjust congestion window size</li></ul></li></ul><p>Structure</p><ul><li>sequence number - numbe assigned to the first byte of data in this segment</li><li>ACK # - the seq # of the next expected byte; flagged as a single bit</li><li>internet checksum - used to check for corruption</li><li>TCP options (variable length)</li><li>length (of TCP header)</li><li>application data</li><li>RST, SYN, FIN - connection management<ul><li>syn - initiate a connection</li><li>fin - close a connection</li></ul></li><li>recieve window - flow control # of bytes reciever willing to accept<ul><li>protect against buffer overflow</li></ul></li><li>C, E: congestion notification</li></ul><p><img src=https://i.imgur.com/M4nQCr3.png alt></p><p>seq number</p><ul><li>byte stream</li><li>&ldquo;number&rdquo; of first byte in segments data</li><li>sliding window
<img src=https://i.imgur.com/qY5kmsN.png alt></li></ul><p>ack</p><ul><li>seq # of next bytes expected from other side</li><li>cumulative ACK</li></ul><p><img src=https://i.imgur.com/jxhCPpa.png alt></p><p>lost and duplicated segments</p><ul><li>lost<ul><li>host does not recieve data, ack is not send,</li><li>timeout + retransmission</li><li><img src=https://i.imgur.com/wtHhht4.png alt></li><li>sender sets the retransmittion timer when sending a segment</li><li>sender retransmits the segment iin ACK is not recieved when timer fires</li></ul></li><li>duplicated<ul><li>host recieved data, ack is send and lost</li><li>data is resent, and a duplication is detected (same sequence number)</li></ul></li></ul><a href=#connections-setup><h2 id=connections-setup><span class=hanchor arialabel=Anchor># </span>connections setup</h2></a><p>three way handshake to set up virtual connection</p><ul><li>each knowing the other willing to communnicate</li><li>agree on connection parameters (e.g., starting seq # s)</li></ul><p><img src=https://i.imgur.com/XPfKER3.png alt=diagram|400></p><a href=#connection-termination><h2 id=connection-termination><span class=hanchor arialabel=Anchor># </span>connection termination</h2></a><p>half-close</p><ul><li><img src=https://i.imgur.com/Ldi03j9.png alt></li></ul><p>2-way handshake</p><ul><li>combine ack and and server fin message</li><li><img src=https://i.imgur.com/osXuN2h.png alt></li></ul><p><img src=https://i.imgur.com/d1Tt0eL.png alt></p><a href=#tcp-flow-control><h2 id=tcp-flow-control><span class=hanchor arialabel=Anchor># </span>TCP flow control</h2></a><ul><li>happens at reciever side</li><li>we have applications, and in the kernel we have receive buffer</li><li>incoming data is stored in recieve buffer</li><li>applications fetch data from this buffer</li><li>reciever advertises free buffer space in recieve window field in TCP header</li><li>sender limits amount of in-flight data to guarantee recieve buffer will not oveflow</li></ul><p><img src=https://i.imgur.com/wsm9MA5.png alt=diagram></p><a href=#congestion-control><h3 id=congestion-control><span class=hanchor arialabel=Anchor># </span>congestion control</h3></a><p>&ldquo;too many sources sending too much data too fast for network to handle&rdquo;</p><p>consequences:</p><ul><li>long delay (queueing)</li><li>packet loss (buffer overflow)</li></ul><p>different from flow control (one sender too fast for one reciever)</p><p><img src=https://i.imgur.com/Ae5xOa3.png alt=causes></p><p>AIMD</p><ul><li>senders can increase sending rate until packet loss occurs, then decrese rate on loss event</li><li>additive increase: increase sending rate by 1 maximum segment size every RTT until loss detected</li><li>multiplicative decrease: at each loss event, cut sending rate: in half (TCP Reno), to 1 MSS (TCP Tahoe)</li><li><img src=https://i.imgur.com/AeOEapp.png alt=diagram></li><li>creates sawtooth behavioiur: probing for bandwidth</li></ul><p><img src=https://i.imgur.com/Citauiv.png alt></p><ul><li>tcp sender limits transmission: LastByteSent- LastByteAcked &lt; cwnd</li><li>cwnd is dynamically adjusted in response to observed network congestion (implementing TCP congestion control)</li></ul><p>TCP sending behavior: roughly:</p><ul><li>send cwnd bytes,</li><li>wait RTT for ACKS,</li><li>then send more bytes</li></ul><p>TCP rate = cwnd/RTT * bytes/sec</p><p>TCP slow start</p><ul><li>when connectin begins, increase rate exponentially until first loss event<ul><li>intially, cwnd = 1 MSS</li><li>double cwnd every RTT</li><li>increment cwnd for every ack recieved</li></ul></li><li>initally slow but ramps up fast</li><li><img src=https://i.imgur.com/khbzr79.png alt></li></ul><p>ssthresh variable: determines when to switch between exponential and linear</p><a href=#udp><h1 id=udp><span class=hanchor arialabel=Anchor># </span>UDP</h1></a><ul><li>connectionless:<ul><li>no handshaking between UDP sender, reciever</li><li>each UDP segment handled independently of others</li></ul></li><li>beset effort service, UDP segments may be lost or delivered out of order</li><li>no flow and congestion control</li><li>applications<ul><li>streaming</li><li>dns SNMP</li></ul></li><li>less overhead</li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/notes/notes/cosc-203/ data-ctx="18-transport layer" data-src=/notes/cosc-203 class=internal-link>cosc-203</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://jethughes.github.io/notes/js/graph.afdb02e537635f9a611b53a988e5645b.js></script></div></div><div id=contact_buttons><footer><p>Made with <a href=https://obsidian.md>Obsidian</a> using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, 2022</p><ul><li><a href=/notes/>Home</a></li><li><a href=https://github.com/jethughes>Github</a></li><li><a href=https://www.linkedin.com/in/jet-hughes-b3b688237>LinkedIn</a></li></ul></footer></div></div></body></html>